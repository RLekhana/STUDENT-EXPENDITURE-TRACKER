@app.route('/dashboard')
def dashboard():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    user_id = session['user_id']
    expenses = Expense.query.filter_by(user_id=user_id).all()
    total = sum(e.amount for e in expenses)

    # Prepare data for Chart.js
    category_data = {}
    for e in expenses:
        category_data[e.category] = category_data.get(e.category, 0) + e.amount

    categories = list(category_data.keys())
    amounts = list(category_data.values())

    return render_template(
        'dashboard.html',
        expenses=expenses,
        total=total,
        categories=categories,
        amounts=amounts
    )
